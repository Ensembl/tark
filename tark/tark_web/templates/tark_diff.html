{% extends "web_home.html" %}

{% block extra_scripts %}
 <script>
 jQuery(function($) {
    
    
       var assembly_releases = {{ all_assembly_releases|safe|escape }};
       var assembly_releases_refseq = {{ all_assembly_releases_refseq|safe|escape }};
       var assembly_releases_ensembl = {{ all_assembly_releases_ensembl|safe|escape }};
       
       
	 //event handler for diff me source change
     $("#id_diff_me_source").change(function () {
       

       var cur_source_name = $(this).val();
       console.log('cur_source_name ' + cur_source_name);
	   var cur_assembly_name =  $("#id_diff_me_assembly").val(); 
	   console.log('cur_assembly_name ' + cur_assembly_name);
	   
	   if(cur_source_name == "Ensembl"){
	    //set assembly
	    var ensembl_assemblies = Object.keys(assembly_releases_ensembl);
	    console.log(ensembl_assemblies);
	    var assembly_options = $.map(ensembl_assemblies, function(ensembl_assembly){
            return '<option value="' + ensembl_assembly + '">' + ensembl_assembly + '</option>'
        }).join('');
        $("#id_diff_me_assembly").html(assembly_options);
        
        //set release
        var releases = assembly_releases_ensembl[cur_assembly_name] || [];
       
       var release_options = $.map(releases, function(release){
            return '<option value="' + release + '">' + release + '</option>'
        }).join('');
        $("#id_diff_me_release").html(release_options);
	    
	   }else{
	    console.log('reached else==');
	    var refseq_assemblies = Object.keys(assembly_releases_refseq);
	    console.log('refseq_assemblies');
	    console.log(refseq_assemblies);

	    var assembly_options = $.map(refseq_assemblies, function(refseq_assembly){
            return '<option value="' + refseq_assembly + '">' + refseq_assembly + '</option>'
        }).join('');
        $("#id_diff_me_assembly").html(assembly_options);

	  
       var releases = assembly_releases_refseq[cur_assembly_name] || [];
       console.log(releases)
       var release_options = $.map(releases, function(release){
            return '<option value="' + release + '">' + release + '</option>'
        }).join('');
        $("#id_diff_me_release").html(release_options);
        
        }
        
     });
    
    
     //event handler for diff with source change
     $("#id_diff_with_source").change(function () {
       

       var cur_source_name = $(this).val(); 
	   var cur_assembly_name =  $("#id_diff_with_assembly").val(); 
	   console.log('cur_assembly_name ' + cur_assembly_name);
	   
	   if(cur_source_name == "Ensembl"){
	    //set assembly
	    var ensembl_assemblies = Object.keys(assembly_releases_ensembl);
	    console.log(ensembl_assemblies);
	    var assembly_options = $.map(ensembl_assemblies, function(ensembl_assembly){
            return '<option value="' + ensembl_assembly + '">' + ensembl_assembly + '</option>'
        }).join('');
        $("#id_diff_with_assembly").html(assembly_options);
        
        //set release
        var releases = assembly_releases_ensembl[cur_assembly_name] || [];
       
       var release_options = $.map(releases, function(release){
            return '<option value="' + release + '">' + release + '</option>'
        }).join('');
        $("#id_diff_with_release").html(release_options);
	    
	   }else{

	    var refseq_assemblies = Object.keys(assembly_releases_refseq);
	    console.log('refseq_assemblies from diff with');
	    console.log(refseq_assemblies);
	    var assembly_options = $.map(refseq_assemblies, function(refseq_assembly){
            return '<option value="' + refseq_assembly + '">' + refseq_assembly + '</option>'
        }).join('');
        $("#id_diff_with_assembly").html(assembly_options);
       var cur_assembly_name =  $("#id_diff_with_assembly").val();
       var releases = assembly_releases_refseq[cur_assembly_name] || [];
       
       console.log(releases);
       var release_options = $.map(releases, function(release){
            return '<option value="' + release + '">' + release + '</option>'
        }).join('');
        $("#id_diff_with_release").html(release_options);

        }
        
     });
    
    
    
    
  });
  </script>
{% endblock %}


{% load staticfiles %}
{% load add_class %}

{% block content %}

<div class="container" style="padding-top:20px;">

<div class="panel panel-info ">
  <div class="panel-heading"><i class="glyphicon glyphicon-info-sign"></i> <strong>Tark Transcript Diff</strong></div>
  <div class="panel-body">
  Use this tool to find differences between the releases for the given Transcript (eg: ENST00000380152)
  </div>
</div>

<div class="row">
	<form id="diff_form" class="form-horizontal" method="POST" action="">
	{% csrf_token %}
	{% for error in form.non_field_errors %}
      <div class="form-group has-errors text-danger small">
     {{error}}
     </div>
 	{% endfor %}

	<div class="col-md-6">
		<div class="panel panel-primary">
			<div class="panel-heading"><strong>Diff Me</strong></div>
				<div class="panel-body">

  				<div class="form-group">
    			<label class="control-label col-md-3" for="species">Species:</label>
				    <div class="col-md-6">
				     {{ form.species|add_class:"form-control" }}
				    </div>
				  </div>
				
				<div class="form-group">
  				<label class="control-label col-md-3" for="source">Source:</label>
   					<div class="col-md-6">
    				{{ form.diff_me_source|add_class:"form-control"}}
  					</div>
  				</div>
  				
				  <div class="form-group">
				    <label class="control-label col-md-3" for="stable_id">StableID:</label>
				    <div class="col-md-6">
				    {{ form.diff_me_stable_id|add_class:"form-control"}}
				    </div>
				    
				  </div>
				
				
				  <div class="form-group">
				 
				  <label class="control-label col-md-3 for="diff_me_assembly">Assembly/Release:</label>
				   <div class="col-md-4">
				   {{ form.diff_me_assembly|add_class:"form-control"}}
				  </div>
				 
				   <div class="col-md-2">
				    {{ form.diff_me_release|add_class:"form-control"}}
				   </div>
				  </div>


				
				
				</div>
			</div>
	</div>
	
	<div class="col-md-6">
		<div class="panel panel-success">
			<div class="panel-heading"><strong>Diff With</strong></div>
				<div class="panel-body">
				
				<div class="form-group">
    			<label class="control-label col-md-3" for="species">Species:</label>
				    <div class="col-md-6">
				     {{ form.species|add_class:"form-control" }}
				    </div>
				  </div>
				
				<div class="form-group">
  				<label class="control-label col-md-3" for="source">Source:</label>
   					<div class="col-md-6">
    				{{ form.diff_with_source|add_class:"form-control"}}
  					</div>
  				</div>
  				
				  <div class="form-group">
				    <label class="control-label col-md-3" for="stable_id">StableID:</label>
				    <div class="col-md-6">
				    {{ form.diff_with_stable_id|add_class:"form-control"}}
				    </div>
				    
				    
				  </div>
				
				
				<div class="form-group">
				  <label class="control-label col-md-3" for="diff_with_assembly">Assembly/Release:</label>
				  <div class="col-md-4">
				   {{ form.diff_with_assembly|add_class:"form-control"}}
				  </div>
				  
				   <div class="col-md-2">
				    {{ form.diff_with_release|add_class:"form-control"}}
				   </div>
				  </div>
				
					
					
					
					
					
				</div>
			</div>
	</div>

<button type="submit" class="btn btn-info btn-block">Diff Transcripts</button>
</form>
</div>



</div>

{% endblock %}