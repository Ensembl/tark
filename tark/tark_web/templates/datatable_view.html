{% extends "web_home.html" %}

{% block title %}DataTable{% endblock %}

{% load staticfiles %}
{% load add_class %}

{% block extra_styles %}
{% endblock %}

{% block extra_scripts %}
<script type="text/javascript">
    $(document).ready(function() {

    //datatable
    var tark_table = $('#tark_datatable').DataTable( {

        "initComplete": function(settings, json) {
         $('#loadingSpinner').hide();
         $('#compare_with_div').show();
         

        },
        "serverSide": {{server_side_processing}},
        {% if server_side_processing == 'true' %}
        "ajax": "/web/datatable_serverside/{{table_name}}/{{assembly_name}}/{{release_name}}/",
        {% else %}
         "ajax": "/web/datatable_clientside/{{table_name}}/{{assembly_name}}/{{release_name}}/",
        {% endif %}
        
       "data":{'serverSide':{{ server_side_processing }} },
        aoColumns: [
            {% for fields in data_fields %}
  			{ "mData": "{{ fields }}", sDefaultContent: "" },
  	        {% endfor %}
		],
    } );
    
    //tark_table.columns.adjust().draw();
    
    //datatable2 compare with
    var tark_table_compare_with = $('#tark_datatable_compare_with').DataTable( {

        "initComplete": function(settings, json) {
         $('#loadingSpinner_compare_with').hide();
        },
        "serverSide": {{server_side_processing}},
        {% if server_side_processing == 'true' %}
        "ajax": "/web/datatable_serverside/{{table_name}}/{{assembly_name_compare}}/{{release_name_compare}}/",
        {% else %}
         "ajax": "/web/datatable_clientside/{{table_name}}/{{assembly_name_compare}}/{{release_name_compare}}/",
        {% endif %}
        
       "data":{'serverSide':{{ server_side_processing }} },
        aoColumns: [
            {% for fields in data_fields %}
  			{ "mData": "{{ fields }}", sDefaultContent: "" },
  	        {% endfor %}
		],
    } );

     //diff with assembly
     var assembly_releases = {{ all_assembly_releases|safe|escape }};
     var options_empty = '<option value="' + '' + '">' + '' + '</option>'
     var options = $.map(Object.keys(assembly_releases), function(assembly){
            return '<option value="' + assembly + '">' + assembly + '</option>'
        }).join('');
     options = options_empty + options;
     //$("#id_diff_with_assembly").html(options);
   } );

 jQuery(function($) {
     $("#id_diff_with_assembly").change(function () {
       var assembly_releases = {{ all_assembly_releases|safe|escape }};
        var cur_assembly_name = $(this).val(); 

        var releases = assembly_releases[cur_assembly_name] || [];
        var options = $.map(releases, function(release){
            return '<option value="' + release + '">' + release + '</option>'
        }).join('');
        $("#id_diff_with_release").html(options);
    });
    
   
  });
  </script>
{% endblock %}



{% block content %}
   <div class="container-fluid" style="padding-left:50px;padding-right:50px;">
   <div class="row">
    <div id="loadingSpinner"><strong>Loading, please wait... </strong><img id="loading-img" src="{% static '/images/ajax-loader.gif' %}"><p></p></div>
    <div class="well well-sm" style="color: #31708f;background-color: #d9edf7;border-color: #bce8f1;">Current Assembly: "{{ assembly_name }}"  Current Release: "{{ release_name }}". To filter type: ENST00000302118 in search box </div>
    <table id="tark_datatable" class="table table-striped table-bordered compact" cellspacing="0" width="95%">
      <thead>
            <tr>
             {% for fields in data_fields %}
                <th>{{ fields }}</th>
             {% endfor %}
            </tr>
      </thead>
     
    </table>
    </div>
    
    <div class="row" id="compare_with_div" style="display: none;">
    <div class="well well-sm" style="color: #3c763d;background-color: #dff0d8;border-color: #d6e9c6;">Compare Assembly: "{{ assembly_name_compare }}"  Compare Release: "{{ release_name_compare }}". To filter type: ENST00000302118 in search box. To compare the current release set with other release set, please choose the release version from below</div>

    
    <div class="well">
    
    <form id="compare_form" class="form-horizontal" method="POST" action="">
    {% csrf_token %}
  	<div class="form-group">
   	<label class="control-label col-sm-2" for="assembly">Assembly/Release:</label>
   	<div class="col-sm-3">
    {{ form.diff_with_assembly|add_class:"form-control"}}
  	</div>
 
   	<div class="col-sm-1">
      {{ form.diff_with_release|add_class:"form-control"}}
   	</div>
   	
   	<div class="col-sm-3">
    <button type="submit" class="btn btn-primary btn-block">Compare Transcript Set</button>	
    </div>
   	
  	</div>

	</form>
    </div>

   

    <div id="loadingSpinner_compare_with"><strong>Loading, please wait... </strong><img id="loading-img" src="{% static '/images/ajax-loader.gif' %}"><p></p></div>
    
    
    <table id="tark_datatable_compare_with" class="table table-striped table-bordered compact" cellspacing="0" width="95%">
      <thead>
            <tr>
             {% for fields in data_fields %}
                <th>{{ fields }}</th>
             {% endfor %}
            </tr>
      </thead>
     
    </table>
    
    </div>
    
  </div>
{% endblock %}




